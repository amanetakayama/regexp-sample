<html>
  <head>
    <meta charset="utf-8" />
    <title>ã‚ªã‚¦ãƒ è¿”ã—</title>
  </head>
  <style>
    body {
      background-color: #fad2d0;
    }
    .center-box {
      text-align: center;
    }
    .large-text {
      font-size: 4rem;
    }
  </style>
  <body>
    <center>
      <h1>ä¸–ç•Œã®ã€Œã‚ã‚ŠãŒã¨ã†ã€ã«æŒ‘æˆ¦ã—ã‚ˆã†ï¼</h1>
      <p>ã†ã¾ãç™ºéŸ³ã™ã‚‹ã¨ã€ã©ã“ã®å›½ã®ã€Œã‚ã‚ŠãŒã¨ã†ã€ã‹æ•™ãˆã¦ãã‚Œã¾ã™ğŸ˜Š</p>
      <h2>
        ã€Œã‚ã‚ŠãŒã¨ã†ã€ã€Œã‚µãƒ³ã‚­ãƒ¥ãƒ¼ã€ã€Œã‚«ãƒ ã‚µãƒãƒ ãƒ‹ãƒ€ ã€
        ã€Œãƒ¡ãƒ«ã‚·ãƒ¼ãƒœãƒ¼ã‚¯ãƒ¼ã€ã€Œãƒ€ãƒ³ã‚±ã‚·ã‚§ãƒ¼ãƒ³ã€<br />
        ã€Œã‚°ãƒ©ãƒ¼ãƒ„ã‚£ã‚¨ã€ã€Œã‚°ãƒ©ã‚·ã‚¡ã‚¹ã€ ã€Œãƒ†ã‚·ã‚§ã‚­ãƒ¥ãƒ«ã‚¨ãƒ‡ãƒªãƒ ã€
        ã€Œãƒãƒãƒ­ã€ã€Œã‚¹ãƒ‘ã‚·ã‚£ãƒ¼ãƒã€ ã€Œã‚¿ãƒƒã‚¯ã€
      </h2>
    </center>

    <p class="center-box"><img id="mic" src="micoff.svg" /></p>
    <div id="result-div" class="large-text"></div>
    <script>
      const resultDiv = document.querySelector("#result-div");
      const micDiv = document.querySelector("#mic");
      let speakingtime = 0;

      // éŸ³å£°èªè­˜æ©Ÿèƒ½(Chrome)
      let rec = new webkitSpeechRecognition();
      let stopped = true;
      rec.continuous = true;
      rec.interimResults = false;
      rec.lang = "ja-JP";

      micDiv.onclick = function () {
        if (stopped == true) {
          stopped = false;
          resultDiv.innerHTML = "";
          rec.start();
        } else {
          stopped = true;
          rec.stop();
        }
      };

      rec.onstart = function () {
        console.log("on start");
        micDiv.setAttribute("src", "micon.svg");
        speakingtime = 0;
      };

      rec.onend = function () {
        console.log("on end");
        micDiv.setAttribute("src", "micoff.svg");
        if (stopped == false) {
          setTimeout(function () {
            rec.start();
          }, speakingtime);
        }
      };

      rec.onresult = function (e) {
        rec.stop();
        for (let i = e.resultIndex; i < e.results.length; i++) {
          if (e.results[i].isFinal) {
            console.log(e);
            let text = e.results[i][0].transcript;
            resultDiv.innerHTML = text;
            console.log(text);
            let reg = /ã‚ã‚ŠãŒã¨ã†/;
            let reg1 = /ã‚µãƒ³ã‚­ãƒ¥ãƒ¼/;
            let reg2 = /ã‚«ãƒ ã‚µãƒãƒ ãƒ‹ãƒ€/;
            let reg3 = /ãƒ¡ãƒ«ã‚·ãƒ¼ãƒœãƒ¼ã‚¯ãƒ¼/;
            let reg4 = /ãƒ€ãƒ³ã‚±ã‚·ã‚§ãƒ¼ãƒ³/;
            let reg5 = /ã‚°ãƒ©ãƒ¼ãƒ„ã‚£ã‚¨/;
            let reg6 = /ã‚°ãƒ©ã‚·ã‚¡ã‚¹/;
            let reg7 = /ãƒ†ã‚·ã‚§ã‚­ãƒ¥ãƒ«ã‚¨ãƒ‡ãƒªãƒ /;
            let reg8 = /ãƒãƒãƒ­/;
            let reg9 = /ã‚¹ãƒ‘ã‚·ã‚£ãƒ¼ãƒ/;
            let reg10 = /ã‚¿ãƒƒã‚¯/;

            if (reg.test(text)) {
              text = "ã‚ã‚ŠãŒã¨ã†ã€æ—¥æœ¬èªã§ã™";
            } else if (reg1.test(text)) {
              text = "ã‚µãƒ³ã‚­ãƒ¥ãƒ¼ã€è‹±èªã§ã™";
            } else if (reg2.test(text)) {
              text = "ã‚«ãƒ ã‚µãƒãƒ ãƒ‹ãƒ€ã€éŸ“å›½èªã§ã™";
            } else if (reg3.test(text)) {
              text = "ãƒ¡ãƒ«ã‚¹ã‚£ãƒ¼ãƒœãƒ¼ã‚¯ãƒ¼ã€ãƒ•ãƒ©ãƒ³ã‚¹èªã§ã™";
            } else if (reg4.test(text)) {
              text = "ãƒ€ãƒ³ã‚±ã‚·ã‚§ãƒ¼ãƒ³ã€ãƒ‰ã‚¤ãƒ„èªã§ã™";
            } else if (reg5.test(text)) {
              text = "ã‚°ãƒ©ãƒ¼ãƒ„ã‚£ã‚¨ã€ã‚¤ã‚¿ãƒªã‚¢èªã§ã™";
            } else if (reg6.test(text)) {
              text = "ã‚°ãƒ©ã‚·ã‚¡ã‚¹ã€ã‚¹ãƒšã‚¤ãƒ³èªã§ã™";
            } else if (reg7.test(text)) {
              text = "ãƒ†ã‚·ã‚§ã‚­ãƒ¥ãƒ«ã‚¨ãƒ‡ãƒªãƒ ã€ãƒˆãƒ«ã‚³èªã§ã™";
            } else if (reg8.test(text)) {
              text = "ãƒãƒãƒ­ã€ãƒãƒ¯ã‚¤èªã§ã™";
            } else if (reg9.test(text)) {
              text = "ã‚¹ãƒ‘ã‚·ã‚£ãƒ¼ãƒã€ãƒ­ã‚·ã‚¢èªã§ã™";
            } else if (reg10.test(text)) {
              text = "ã‚¿ãƒƒã‚¯ã€ãƒ‡ãƒ³ãƒãƒ¼ã‚¯èªã€ãƒãƒ«ã‚¦ã‚§ãƒ¼èªã€ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³èªã§ã™";
            } else {
              text = "ã‚‚ã†ä¸€åº¦ã€ç™ºéŸ³ã—ã¦ã¿ã¾ã—ã‚‡ã†";
            }
            speakingtime = text.length * 200;
            console.log("estimate:", speakingtime, "ms");
            speak(text);
          }
        }
      };

      // ç™ºè©±æ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
      let msg = new SpeechSynthesisUtterance();
      //let voices = window.speechSynthesis.getVoices();

      function speak(text) {
        // ä»¥ä¸‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®šï¼ˆæ—¥æœ¬èªã¯åŠ¹ã‹ãªã„ã‚‚ã‚ˆã†ã€‚ã€‚ï¼‰
        //msg.voice = voices[7]; // 7:Google æ—¥æœ¬äºº ja-JP â€»ä»–ã¯è‹±èªã®ã¿
        msg.volume = 1.0; // éŸ³é‡ min 0 ~ max 1
        msg.rate = 1.0; // é€Ÿåº¦ min 0 ~ max 10
        msg.pitch = 1.0; // éŸ³ç¨‹ min 0 ~ max 2

        msg.text = text; // å–‹ã‚‹å†…å®¹
        msg.lang = "ja-JP"; // en-US or ja-JP
        // msg.lang = 'en-US'; // en-US or ja-JP

        // ç™ºè©±å®Ÿè¡Œ
        speechSynthesis.speak(msg);
      }

      // çµ‚äº†æ™‚ã®å‡¦ç†
      msg.onend = function (event) {
        console.log("å–‹ã£ãŸæ™‚é–“ï¼š" + event.elapsedTime + "ms");
      };
    </script>
  </body>
</html>
